<!DOCTYPE html>
<html lang="en" dir="ltr">
   <head>
      <!--This style tag goes in the head of documents needing the fancy video games font.-->
      <!--The section fonts are specified in the CSS, but each page with the font needs this import-->
      <style>
         @import url('https://fonts.googleapis.com/css2?family=Fira+Code&family=Press+Start+2P&display=swap');
      </style>
      <meta charset="utf-8">
      <link rel="icon" type="image/png" sizes="192x192"  href="../icons/android-icon-192x192.png">
      <link rel="icon" type="image/png" sizes="32x32" href="../icons/favicon-32x32.png">
      <link rel="icon" type="image/png" sizes="96x96" href="../icons/favicon-96x96.png">
      <link rel="icon" type="image/png" sizes="16x16" href="../icons/favicon-16x16.png">
      <title>HHC Solutions</title>
      <link rel="stylesheet" href="../styles.css">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"/>
   </head>
   <body>
	<div class="wrapper">
	   <input type="checkbox" id="btn" hidden>
	   <label for="btn" class="menu-btn">
	   <i class="fas fa-bars"></i>
	   <i class="fas fa-times"></i>
	   </label>
	   <nav id="sidebar">
		  <div class="title">
			 Navigation Menu
		  </div>
		  <ul class="list-items">
			<li><a href="../index.html"><i class="fas fa-home"></i>Home</a></li>
			<li><a href="../orientation/orientation.html"><i class="fas fa-stream"></i>Orientation</a></li>
			<li><a href="../the-north-pole/the-north-pole.html"><i class="fas fa-stream"></i>North Pole</a></li>
			<li><a href="../entry/entry.html"><i class="fas fa-stream"></i>Entry</a></li>
			<li><a href="../dining-room/dining-room.html"><i class="fas fa-stream"></i>Dining Room</a></li>
			<li><a href="../great-room/great-room.html"><i class="fas fa-stream"></i>Great Room</a></li>
			<li><a href="../kitchen/kitchen.html"><i class="fas fa-stream"></i>Kitchen</a></li>
			<li><a href="../courtyard/courtyard.html"><i class="fas fa-stream"></i>Courtyard</a></li>
			<li><a href="../talks-lobby/talks-lobby.html"><i class="fas fa-stream"></i>Talks Lobby</a></li>               
			<li><a href="../speaker-unpreparation-room/speaker-unpreparation-room.html"><i class="fas fa-stream"></i>UNPreparation Room</a></li>
			<li><a href="../santas-office/santas-office.html"><i class="fas fa-stream"></i>Santa's Office</a></li>
			<li><a href="../netwars/netwars.html"><i class="fas fa-stream"></i>netwars</a></li>
			<li><a href="../frost-tower-lobby/frost-tower-lobby.html"><i class="fas fa-stream"></i>Frost Tower Lobby</a></li>
			<li><a href="../jacks-studio/jacks-studio.html"><i class="fas fa-stream"></i>Jack's Studio</a></li>
			<li><a href="../jacks-office/jacks-office.html"><i class="fas fa-stream"></i>Jack's Office</a></li>               
			<li><a href="../jacks-restroom/jacks-restroom.html"><i class="fas fa-stream"></i>Jack's Restroom</a></li>

			 <div class="icons">
				<a href="https://www.facebook.com/clayton.vantol"><i class="fab fa-facebook-f"></i></a>
				<a href="https://twitter.com/1337VT"><i class="fab fa-twitter"></i></a>
				<a href="https://www.linkedin.com/in/claytonvantol/"><i class="fab fa-linkedin"></i></a>
			 </div>
		  </ul>
	   </nav>
	</div>
	<!-- Contenido aquÃ­. -->
	<div class="content">
		<div style="margin-left:20%;padding:1px 16px;height:1000px;">
			<br>
			<hr class="thick">
			<br>
			<videoGameFont>Yara Analysis</videoGameFont><br>
			<videoGameSubtitleFont>Cranberry Pi Terminal near Fitzy Shortstack</videoGameSubtitleFont><br>
			<br>
			<hr class="thin">
			<br>
			<p style="text-align: left;">Upon opening the yara challenge Cranberry Pi, you immediately know this elf can figure out how to patch a binary file since they were savvy enough to set a message for you in <term>/etc/motd</term> which details exactly what the issue is.  Any way you look at it, much like Bruce Willis' character John McClane in Die Hard, you are the protagonist who saves Christmas!  Let's get to it.</p>
			<br><p style="text-align: left;">Use <term>:set</term> to set options of your vim instance.  These options can also be entered into <term>~/.vimrc</term> to persist between launches just like environment options or aliases in your <term>~/.bashrc</term> or sometimes <term>~/.bash_aliases</term> file.  Another nice option I like to set in vim is <term>:set number</term>.  This shows line numbers in the left column.</p>
			<br>
			<p style="text-align: center;">Try using <term>:set binary</term></p>
			<br>
			<p>I added the following to my <term>~/.vimrc</term> file:</p>
			<br><img src="yara01.PNG" alt="yara stuff"><br>

			<p>First off, when running <term>the_critical_elf_app</term> initially you are presented with an error indicating yara rule 135 has detected the program.</p>
			<br><img src="yara02.PNG" alt="yara stuff"><br>

			<p>Use <term>less /yara_rules_rules.yar</term> and search for the rule by typing '/' within less to search for "rule_135".  In the strings area, the rule is looking for the string "candycane".  Let's change the program so the rule doesn't fire.</p>
			<br><img src="yara03.PNG" alt="yara stuff"><br>

			<p>Open the_critical_elf_app with vim.  Remember to use "/" to search like we did with less earlier.  Simply change the "candycane" string to "sandycane" or anything else really.  Just make sure the string length is the same.  Once done, run the program again.</p>
			<br><img src="yara04.PNG" alt="yara stuff"><br>

			<p>Running the program again produces another yara rule error.  Check out what it is.</p>
			<br><img src="yara05.PNG" alt="yara stuff"><br>
			<br>
			<p><term>$s1 = {6c 6962 632e 736f 2e36}</term></p>
			<p>This hex converts to "libc.so.6"</p>
			<p>Make sure to try running the program afterward to ensure you don't receive a segmentation fault.  Once again, open the program in vim, use "/" to search, change the string and save.</p>
			<br>
			<p><term>$hs2 = {726f 6772 616d 2221}</term></p>
			<p>Convert again to get another string: "rogram!!"</p>
			<p>Use the same method as above to change those strings.  When finished, run the program again.  Unfortunately, we get yet another rule to bypass.</p><br>

			<p style="text-align: left;"><term>rule yara_rule_1732 {<br>
			&nbsp;meta:<br>
			&nbsp;&nbsp;description = "binaries - alwayz_winter.exe"<br>
			&nbsp;&nbsp;author = "Santa"<br>
			&nbsp;&nbsp;reference = "North Pole Malware Research Lab"<br>
			&nbsp;&nbsp;date = "1955-04-22"<br>
			&nbsp;&nbsp;hash = "c1e31a539898aab18f483d9e7b3c698ea45799e78bddc919a7dbebb1b40193a8"<br>
			&nbsp;strings:<br>
			&nbsp;&nbsp;$s1 = "This is critical for the execution of this program!!" fullword ascii<br>
			&nbsp;&nbsp;$s2 = "__frame_dummy_init_array_entry" fullword ascii<br>
			&nbsp;&nbsp;change $s3 = ".note.gnu.property" fullword ascii<br>
			&nbsp;&nbsp;$s4 = ".eh_frame_hdr" fullword ascii<br>
			&nbsp;&nbsp;$s5 = "__FRAME_END__" fullword ascii<br>
			&nbsp;&nbsp;$s6 = "__GNU_EH_FRAME_HDR" fullword ascii<br>
			&nbsp;&nbsp;change $s7 = "frame_dummy" fullword ascii<br>
			&nbsp;&nbsp;change $s8 = ".note.gnu.build-id" fullword ascii<br>
			&nbsp;&nbsp;$s9 = "completed.8060" fullword ascii<br>
			&nbsp;&nbsp;$s10 = "_IO_stdin_used" fullword ascii<br>
			&nbsp;&nbsp;change $s11 = ".note.ABI-tag" fullword ascii<br>
			&nbsp;&nbsp;change $s12 = "naughty string" fullword ascii<br>
			&nbsp;&nbsp;change $s13 = "dastardly string" fullword ascii<br>
			&nbsp;&nbsp;$s14 = "__do_global_dtors_aux_fini_array_entry" fullword ascii<br>
			&nbsp;&nbsp;$s15 = "__libc_start_main@@GLIBC_2.2.5" fullword ascii<br>
			&nbsp;&nbsp;$s16 = "GLIBC_2.2.5" fullword ascii<br>
			&nbsp;&nbsp;change $s17 = "its_a_holly_jolly_variable" fullword ascii<br>
			&nbsp;&nbsp;$s18 = "__cxa_finalize" fullword ascii<br>
			&nbsp;&nbsp;change $s19 = "HolidayHackChallenge{NotReallyAFlag}" fullword ascii<br>
			&nbsp;&nbsp;$s20 = "__libc_csu_init" fullword ascii<br>
			&nbsp;condition:<br>
			&nbsp;&nbsp;uint32(1) == 0x02464c45 and filesize &lt; 50KB and<br>
			&nbsp;&nbsp;10 of them</term></p><br>

			<p>To get around that size condition at the end, you can just make a copy of the executable and add some garbage data to the end of it.  Nothing points to the extra data so it doesn't really matter what it is.  Just append some junk to the end and run it!</p>

			<br><img src="yara06.PNG" alt="yara stuff"><br>


			<br><br><p><videoGameSubtitleFont>Bonus:</videoGameSubtitleFont></p>
			<p>Enter :%!xxd to view the hexdump in vim.</p>
		<p>% is used in vim to replace the contents of the file with the output of the shell command run using !.</p>
		<p>:%!xxd</p>
		<p>Be sure to talk to Fitzy Shortstack after solving the challenge to gather more hints for the Splunk challenge!</p>
		</div>
	</div>
	</body>
	</html>